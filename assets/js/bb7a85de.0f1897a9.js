"use strict";(self.webpackChunkscrypt_docs=self.webpackChunkscrypt_docs||[]).push([[351],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(h,l(l({ref:t},p),{},{components:n})):a.createElement(h,l({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var c=2;c<o;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2786:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={},l="How to integrate DotWallet",i={unversionedId:"how-to-integrate-a-frontend/how-to-integrate-dotwallet",id:"how-to-integrate-a-frontend/how-to-integrate-dotwallet",title:"How to integrate DotWallet",description:"DotWallet is a lightweight wallet designed to help users easily and securely manage their digital assets. We will introduce how to integrate DotWallet.",source:"@site/docs/how-to-integrate-a-frontend/how-to-integrate-dotwallet.md",sourceDirName:"how-to-integrate-a-frontend",slug:"/how-to-integrate-a-frontend/how-to-integrate-dotwallet",permalink:"/how-to-integrate-a-frontend/how-to-integrate-dotwallet",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How to Integrate With a Frontend",permalink:"/how-to-integrate-a-frontend/"},next:{title:"How to Publish a Contract to NPM",permalink:"/how-to-publish-a-contract"}},s={},c=[{value:"OAuth 2.0",id:"oauth-20",level:2},{value:"DotWallet Developer Platform",id:"dotwallet-developer-platform",level:2},{value:"Implementation",id:"implementation",level:2},{value:"<code>DotWalletSigner</code>",id:"dotwalletsigner",level:3}],p={toc:c};function d(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-integrate-dotwallet"},"How to integrate DotWallet"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.dotwallet.com/en"},"DotWallet")," is a lightweight wallet designed to help users easily and securely manage their digital assets. We will introduce how to integrate DotWallet."),(0,r.kt)("h2",{id:"oauth-20"},"OAuth 2.0"),(0,r.kt)("p",null,"DotWallet user authorization follows the standard authorization code flow of OAuth2. See ",(0,r.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc6749#section-4.1"},"RFC6749")," for details. "),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(3509).Z,width:"820",height:"450"})),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://medium.com/@vihanga_liyanage/iam-for-dummies-oauth-2-grant-types-397197a26024"},"credit to Vihanga Liyanage")),(0,r.kt)("p",null,"User authorization is based on Oauth2's Authorization Code grant. Authorization Code grant flow:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Construct URI. "),(0,r.kt)("p",{parentName:"li"},"Example URI: ",(0,r.kt)("inlineCode",{parentName:"p"},"https://api.ddpurse.com/v1/oauth2/authorize?client_id=YOUR-CLIENT-ID&redirect_uri=http%3A%2F%2FYOUR-REDIRECT-URL&response_type=code&state=YOUR-STATE&scope=user.info")),(0,r.kt)("p",{parentName:"li"},"URL Parameters:"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"client_id"),(0,r.kt)("td",{parentName:"tr",align:null},"YES"),(0,r.kt)("td",{parentName:"tr",align:null},"Developer\u2019s dapp client_id")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"redirect_uri"),(0,r.kt)("td",{parentName:"tr",align:null},"YES"),(0,r.kt)("td",{parentName:"tr",align:null},"The redirect URL after authorization. Needs to be url_encoded")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"state"),(0,r.kt)("td",{parentName:"tr",align:null},"YES"),(0,r.kt)("td",{parentName:"tr",align:null},"It is recommended to use a random string of more than 32 bits (such as UUID). The state is used to verify the consistency of the request and callback. This can prevent csrf attacks.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"response_type"),(0,r.kt)("td",{parentName:"tr",align:null},"YES"),(0,r.kt)("td",{parentName:"tr",align:null},"Fill in the fixed value : ",(0,r.kt)("inlineCode",{parentName:"td"},"code"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"scope"),(0,r.kt)("td",{parentName:"tr",align:null},"YES"),(0,r.kt)("td",{parentName:"tr",align:null},"Authorization scope. The list of permissions that the user agrees to authorize. These permissions are required for certain API endpoints. Needs to be url_encoded. Use spaces to separate multiple permissions. For a list of currently supported scope permissions, please check the scope list below"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Redirect the user to the URI constructed in ",(0,r.kt)("strong",{parentName:"p"},"1")),(0,r.kt)("p",{parentName:"li"},"After clicking the link, the user will be directed to the DotWallet authorization page. DotWallet will ask the user to log in, and then ask whether they agree to authorize the application for the listed permission scopes.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Receive the ",(0,r.kt)("inlineCode",{parentName:"p"},"code")," through the callback uri."),(0,r.kt)("p",{parentName:"li"},"After the user agrees to authorization in ",(0,r.kt)("strong",{parentName:"p"},"2"),", DotWallet will redirect the client to the redirect_uri specified by the application. The authorization code code and the provided state will be included in the query parameters.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Exchange code for access_token. The access tokens are credentials used to access protected resources, which are issued by the authorization server."))),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"To avoid security issues, any request for using or obtaining ",(0,r.kt)("inlineCode",{parentName:"p"},"access_token")," must be made from the backend server. Do not disclose your ",(0,r.kt)("inlineCode",{parentName:"p"},"access_token")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret"),(0,r.kt)("sup",null,"1")," on the client side.")),(0,r.kt)("h2",{id:"dotwallet-developer-platform"},"DotWallet Developer Platform"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Before using DotWallet, you need to register and create a app on ",(0,r.kt)("a",{parentName:"li",href:"https://developers.dotwallet.com/en"},"DotWallet Developer Platform"),".")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(5970).Z,width:"1995",height:"670"})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"After creating the app, you will receive an email containing ",(0,r.kt)("inlineCode",{parentName:"li"},"app_id")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"secret"),".")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(3264).Z,width:"907",height:"493"})),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Next, you need to set ",(0,r.kt)("a",{parentName:"li",href:"https://www.oauth.com/oauth2-servers/redirect-uris"},"redirection URI"),". Redirect URLs are a critical part of the OAuth flow. After a user successfully authorizes an application, the authorization server will redirect the user back to the application. For example, in the figure below, we filled in two redirection URIs.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dotwallet-example.vercel.app/callback/"},"https://dotwallet-example.vercel.app/callback/")," is the redirection URI used for product deployment."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://localhost:3000/callback/"},"http://localhost:3000/callback/")," is the redirection URI used for development and debugging.")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(8868).Z,width:"2654",height:"1272"})),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("em",{parentName:"p"},"Callback domain")," in the form is the redirection URIs in OAuth. ")),(0,r.kt)("h2",{id:"implementation"},"Implementation"),(0,r.kt)("p",null,"Here is a code example to create ",(0,r.kt)("inlineCode",{parentName:"p"},"DotWalletSigner")," in ",(0,r.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Nextjs"),":"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Construct URI. ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'export default async function Home() {\n  const loginUrl = `https://api.ddpurse.com/authorize?client_id=${process.env.CLIENT_ID}&redirect_uri=${encodeURIComponent(\n      process.env.REDIRECT_URI || \'\'\n    )}&response_type=code&scope=${encodeURIComponent(\n      "user.info"\n    )}&state=${crypto.randomUUID()}`;\n  \n    return (\n      <main className="flex min-h-screen flex-col items-center justify-between p-24">\n        <div className="m-4 p-4 bg-blue-200 font-bold rounded-lg">\n          <a href={loginUrl}>DotWallet Login</a>\n        </div>\n      </main>\n    );\n}\n')),(0,r.kt)("center",null,"src/app/page.tsx"),(0,r.kt)("p",null,"If the user clicks the ",(0,r.kt)("strong",{parentName:"p"},"DotWallet Login")," button, the page will be redirected to the authorization server page."),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(8837).Z,width:"1920",height:"1091"})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"After the user clicks ",(0,r.kt)("strong",{parentName:"li"},"Agree to authorize")," to log in, the authorization server redirect the user to the redirection URI. The following code receives the ",(0,r.kt)("inlineCode",{parentName:"li"},"code")," through the callback uri. Then exchange the ",(0,r.kt)("inlineCode",{parentName:"li"},"code")," for ",(0,r.kt)("inlineCode",{parentName:"li"},"access_token")," and save it.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { redirect, notFound } from 'next/navigation';\n\nimport token from \"../token\"\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const code = searchParams.get('code');\n\n  if (code) {\n    // exchange the code for access_token\n    const res = await fetch(`https://api.ddpurse.com/v1/oauth2/get_access_token`, {\n      body: JSON.stringify({\n        code,\n        redirect_uri: process.env.REDIRECT_URI,\n        grant_type: \"authorization_code\",\n        client_secret: process.env.CLIENT_SECRET,\n        client_id: process.env.CLIENT_ID,\n      }),\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      method: 'POST'\n    });\n    const { code: apiCode, data, msg } = await res.json();\n\n    if (apiCode === 0) {\n      const { access_token } = data;\n      // save access_token\n      token.access_token = access_token;\n      // redirect to balance page.\n      redirect('/balance');\n    }\n\n  }\n\n  notFound();\n}\n")),(0,r.kt)("center",null,"src/app/callback/route.ts"),(0,r.kt)("h3",{id:"dotwalletsigner"},(0,r.kt)("inlineCode",{parentName:"h3"},"DotWalletSigner")),(0,r.kt)("p",null,"sCrypt SDK provides ",(0,r.kt)("inlineCode",{parentName:"p"},"DotWalletSigner")," for quick integration with DotWallet."),(0,r.kt)("p",null,"After redirect to the ",(0,r.kt)("inlineCode",{parentName:"p"},"/balance")," page, we can create a ",(0,r.kt)("inlineCode",{parentName:"p"},"DotWalletSigner")," with the OAuth access token. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'import { DotwalletSigner, DefaultProvider } from "scrypt-ts";\nimport token from "../token";\n\nasync function getData() {\n  const provider = new DefaultProvider();\n  const signer = new DotwalletSigner(token.access_token, provider);\n\n  const balance = await signer.getBalance();\n\n  return { balance: balance.confirmed + balance.unconfirmed };\n}\n\nexport default async function Balance() {\n  const data = await getData();\n\n  return (\n    <main className="flex min-h-screen flex-col items-center justify-between p-24">\n      <div className="m-4 p-4 bg-blue-200 font-bold rounded-lg">\n        <label>balance</label> {data.balance}\n      </div>\n    </main>\n  );\n}\n\n')),(0,r.kt)("center",null,"src/app/balance/page.tsx"),(0,r.kt)("p",null,"After creating ",(0,r.kt)("inlineCode",{parentName:"p"},"DotWalletSigner")," with access token, you can call all interfaces of ",(0,r.kt)("inlineCode",{parentName:"p"},"DotWalletSigner")," as in other signers."),(0,r.kt)("p",null,"Congrats! You have completed the integration of DotWallet."),(0,r.kt)("p",null,"Full code is ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zhfnjust/dotwallet-example"},"here"),"."),(0,r.kt)("hr",null),(0,r.kt)("p",null,"[1]"," ",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret")," is usually stored in the backend service. It's used to exchange code for access token."))}d.isMDXComponent=!0},8837:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dotwallet-auth-54d9546108be5338d4752fe8c3a6d5ee.png"},5970:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dotwallet-create-dapp-e42f147593dca06c2f239c2f6d66234b.png"},3264:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dotwallet-mail-fe9a6e67c2a7fcdaef60d9c39594f2fa.png"},8868:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dotwallet-uris-0ad851a53cd726552e2afaf56d89b232.png"},3509:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/oauth2-c0ed02684683987f78f01502b6391332.png"}}]);