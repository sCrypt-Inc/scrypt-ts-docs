"use strict";(self.webpackChunkscrypt_docs=self.webpackChunkscrypt_docs||[]).push([[5243],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=o.createContext({}),s=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=s(e.components);return o.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(n),h=i,d=u["".concat(c,".").concat(h)]||u[h]||m[h]||a;return n?o.createElement(d,r(r({ref:t},p),{},{components:n})):o.createElement(d,r({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var s=2;s<a;s++)r[s]=n[s];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9796:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>m,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var o=n(7462),i=(n(7294),n(3905));const a={sidebar_position:2},r="Tutorial 2: Time Lock",l={unversionedId:"tutorials/timeLock",id:"tutorials/timeLock",title:"Tutorial 2: Time Lock",description:"Overview",source:"@site/docs/tutorials/timeLock.md",sourceDirName:"tutorials",slug:"/tutorials/timeLock",permalink:"/tutorials/timeLock",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Tutorial 1: Hello World",permalink:"/tutorials/hello-world"},next:{title:"Tutorial 3: Auction",permalink:"/tutorials/auction"}},c={},s=[{value:"Overview",id:"overview",level:2},{value:"What is a time lock?",id:"what-is-a-time-lock",level:3},{value:"Implementation",id:"implementation",level:3},{value:"Contract properties",id:"contract-properties",level:2},{value:"The Time-Locked Public Method",id:"the-time-locked-public-method",level:2},{value:"How does it work?",id:"how-does-it-work",level:2},{value:"Conclusion",id:"conclusion",level:2}],p={toc:s};function m(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,o.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"tutorial-2-time-lock"},"Tutorial 2: Time Lock"),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"In this tutorial, we will go over how to create a smart contract, which has a public method, that can only be unlocked once a certain point in time has passed."),(0,i.kt)("h3",{id:"what-is-a-time-lock"},"What is a time lock?"),(0,i.kt)("p",null,"In the context of smart contracts, a time-lock is a feature that restricts the spending of specific bitcoins until a specified future time or block height is reached. sCrypt offers capabilities to implement these types of time-locks in your smart contracts, providing a mechanism to ensure a transaction won't be included in a block before a certain point in time or block height is reached. In other words, the smart contract's method cannot be successfully invoked until that point in time has passed."),(0,i.kt)("p",null,"For instance, this mechanism could be used to add a withdrawal method to a smart contract. In the event of non-cooperation from other parties, an individual could retrieve their funds locked in the smart contract after some amount of time has passed. This approach is utilized in ",(0,i.kt)("a",{parentName:"p",href:"https://xiaohuiliu.medium.com/cross-chain-atomic-swaps-f13e874fcaa7"},"cross-chain atomic swaps"),", for example."),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(4795).Z,width:"640",height:"320"}),"\n",(0,i.kt)("img",{src:n(3848).Z,width:"834",height:"418"}),"\n",(0,i.kt)("em",{parentName:"p"},"Image Credit: ",(0,i.kt)("a",{parentName:"em",href:"https://bcoin.io/guides/swaps.html"},"bcoin"))),(0,i.kt)("h3",{id:"implementation"},"Implementation"),(0,i.kt)("p",null,"In sCrypt, a time-lock can be enforced by constraining the ",(0,i.kt)("inlineCode",{parentName:"p"},"locktime")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"sequence")," values of the ",(0,i.kt)("a",{parentName:"p",href:"../how-to-write-a-contract/scriptcontext"},"script execution context"),". This context pertains to the execution of the transaction, which includes a call to the smart contract's public method. Thus, if the value is constrained \u2013 for example, the ",(0,i.kt)("inlineCode",{parentName:"p"},"locktime")," needs to be above the value ",(0,i.kt)("inlineCode",{parentName:"p"},"1690236000")," (a Unix timestamp) \u2013 then this transaction cannot be included into the blockchain until that point in time."),(0,i.kt)("p",null,"Note that the value of ",(0,i.kt)("inlineCode",{parentName:"p"},"locktime")," can either be a Unix timestamp or a block height. For this value to be enforced, ",(0,i.kt)("inlineCode",{parentName:"p"},"sequence")," also needs to be set to a value less than ",(0,i.kt)("inlineCode",{parentName:"p"},"0xffffffff"),"."),(0,i.kt)("p",null,"sCrypt offers a convenient built-in function ",(0,i.kt)("inlineCode",{parentName:"p"},"timeLock")," to enforce this constraint."),(0,i.kt)("h2",{id:"contract-properties"},"Contract properties"),(0,i.kt)("p",null,"Let's declare the properties of our smart contract:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"// Time after which our public method can be called.\n@prop()\nreadonly matureTime: bigint // Can be a timestamp or block height.\n")),(0,i.kt)("h2",{id:"the-time-locked-public-method"},"The Time-Locked Public Method"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"@method()\npublic unlock() {\n    // The following assertion ensures that the `unlock` method can\n    // not be successfully invoked until `matureTime` has passed.\n    assert(this.timeLock(this.matureTime), 'time lock not yet expired')\n}\n")),(0,i.kt)("p",null,"It is important to note that this mechanism can be employed solely to ensure that a method can be called ",(0,i.kt)("strong",{parentName:"p"},"after")," a specific point in time. In contrast, it cannot be employed to ensure that a method is called ",(0,i.kt)("strong",{parentName:"p"},"before")," a specific point in time. "),(0,i.kt)("h2",{id:"how-does-it-work"},"How does it work?"),(0,i.kt)("p",null,"Under the hood, the ",(0,i.kt)("inlineCode",{parentName:"p"},"timeLock")," function asserts that the ",(0,i.kt)("inlineCode",{parentName:"p"},"sequence")," value of our calling transaction is less than ",(0,i.kt)("inlineCode",{parentName:"p"},"UINT_MAX"),". This ensures that the Bitcoin network will enforce the ",(0,i.kt)("inlineCode",{parentName:"p"},"locktime")," value."),(0,i.kt)("p",null,"Next, it checks if our target time-lock value indicates a block height or a Unix timestamp. If it's using a block height, i.e. the time-lock value is less than 500,000,000, the method also ensures that the ",(0,i.kt)("inlineCode",{parentName:"p"},"locktime")," value of the calling transaction corresponds to a block height."),(0,i.kt)("p",null,"Lastly, the method verifies that the value of ",(0,i.kt)("inlineCode",{parentName:"p"},"locktime")," is greater than or equal to the time-lock we have passed as an argument."),(0,i.kt)("p",null,"For more information on how the ",(0,i.kt)("inlineCode",{parentName:"p"},"locktime")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"sequence")," values work, please read the ",(0,i.kt)("a",{parentName:"p",href:"https://wiki.bitcoinsv.io/index.php/NLocktime_and_nSequence"},"BSV wiki page"),'."'),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"Congratulations! You have completed the time-lock tutorial!"),(0,i.kt)("p",null,"The full code along with ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/sCrypt-Inc/boilerplate/blob/master/tests/timeLock.test.ts"},"tests")," can be found in sCrypt's ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/sCrypt-Inc/boilerplate/blob/master/src/contracts/timeLock.ts"},"boilerplate repository"),"."))}m.isMDXComponent=!0},4795:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/swap1-597f5664552aa55a2618d36c008f6e93.png"},3848:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/swap2-eb0d41670833d5dcc2aad196be3be44f.png"}}]);