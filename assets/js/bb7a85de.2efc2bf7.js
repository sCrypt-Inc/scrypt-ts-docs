"use strict";(self.webpackChunkscrypt_docs=self.webpackChunkscrypt_docs||[]).push([[351],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(a),h=r,m=u["".concat(s,".").concat(h)]||u[h]||d[h]||o;return a?n.createElement(m,i(i({ref:t},p),{},{components:a})):n.createElement(m,i({ref:t},p))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},2786:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var n=a(7462),r=(a(7294),a(3905));const o={},i="How to integrate DotWallet",l={unversionedId:"how-to-integrate-a-frontend/how-to-integrate-dotwallet",id:"how-to-integrate-a-frontend/how-to-integrate-dotwallet",title:"How to integrate DotWallet",description:"DotWallet is a lightweight wallet designed to help users easily and securely manage their digital assets. We will show how to integrate it with sCrypt-powered apps.",source:"@site/docs/how-to-integrate-a-frontend/how-to-integrate-dotwallet.md",sourceDirName:"how-to-integrate-a-frontend",slug:"/how-to-integrate-a-frontend/how-to-integrate-dotwallet",permalink:"/how-to-integrate-a-frontend/how-to-integrate-dotwallet",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How to Integrate With a Frontend",permalink:"/how-to-integrate-a-frontend/"},next:{title:"How to Publish a Contract to NPM",permalink:"/how-to-publish-a-contract"}},s={},c=[{value:"OAuth 2.0",id:"oauth-20",level:2},{value:"DotWallet&#39;s user authorization",id:"dotwallets-user-authorization",level:2},{value:"DotWallet Developer Platform",id:"dotwallet-developer-platform",level:3},{value:"Example Implementation",id:"example-implementation",level:2},{value:"<code>DotWalletSigner</code>",id:"dotwalletsigner",level:3}],p={toc:c};function d(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-integrate-dotwallet"},"How to integrate DotWallet"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.dotWallet.com/en"},"DotWallet")," is a lightweight wallet designed to help users easily and securely manage their digital assets. We will show how to integrate it with sCrypt-powered apps."),(0,r.kt)("h2",{id:"oauth-20"},"OAuth 2.0"),(0,r.kt)("p",null,"OAuth 2.0 is an industry-standard authorization framework that enables third-party applications to access the resources of a user on a web service \u2014- such as Facebook, Google, and Twitter -- without requiring the user to share their credentials directly with the application. It provides a secure and standardized way for users to grant limited access to their protected resources, such as their profile information or photos, to other applications.\nIt works by introducing an authorization layer between the user, the application, and the web service hosting the user's data. Instead of sharing their username and password with the application, the user is redirected to the web service's authentication server. The user then authenticates themselves on the service, and upon successful authentication, the service issues an access token to the application. This access token represents the user's authorization to access specific resources."),(0,r.kt)("p",null,"If you are new to OAuth 2.0, check out thse helpful tutorials:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.okta.com/blog/2019/10/21/illustrated-guide-to-oauth-and-oidc"},"An Illustrated Guide to OAuth and OpenID Connect")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://darutk.medium.com/the-simplest-guide-to-oauth-2-0-8c71bd9a15bb"},"The Simplest Guide To OAuth 2.0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2"},"An Introduction to OAuth 2"))),(0,r.kt)("h2",{id:"dotwallets-user-authorization"},"DotWallet's user authorization"),(0,r.kt)("p",null,"DotWallet uses OAuth 2.0 to allow third-party applications to safely access certain capabilities authorized by DotWallet users. More specifically, it uses Oauth2's authorization code grant type as the diagram shows. See ",(0,r.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc6749#section-4.1"},"RFC6749")," for details. "),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(3509).Z,width:"820",height:"450"})),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://medium.com/@vihanga_liyanage/iam-for-dummies-oauth-2-grant-types-397197a26024"},"Credit: Vihanga Liyanage")),(0,r.kt)("p",null,"Follow ",(0,r.kt)("a",{parentName:"p",href:"https://developers.dotwallet.com/documents/en/#user-authorization"},"these steps")," for a user authorization."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Construct URI. "),(0,r.kt)("p",{parentName:"li"},"Example URI: ",(0,r.kt)("inlineCode",{parentName:"p"},"https://api.ddpurse.com/v1/oauth2/authorize?client_id=YOUR-CLIENT-ID&redirect_uri=http%3A%2F%2FYOUR-REDIRECT-URL&response_type=code&state=YOUR-STATE&scope=user.info")),(0,r.kt)("p",{parentName:"li"},"URL Parameters:"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"client_id"),(0,r.kt)("td",{parentName:"tr",align:null},"Developer\u2019s dapp client_id")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"redirect_uri"),(0,r.kt)("td",{parentName:"tr",align:null},"The redirect URL after authorization. Needs to be url_encoded")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"state"),(0,r.kt)("td",{parentName:"tr",align:null},"It is recommended to use a random string of more than 32 bits (such as UUID). The state is used to verify the consistency of the request and callback. This can prevent csrf attacks.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"response_type"),(0,r.kt)("td",{parentName:"tr",align:null},"Fill in the fixed value : ",(0,r.kt)("inlineCode",{parentName:"td"},"code"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"scope"),(0,r.kt)("td",{parentName:"tr",align:null},"Authorization scope. The list of permissions that the user agrees to authorize. These permissions are required for certain API endpoints. Needs to be url_encoded. Use spaces to separate multiple permissions. For a list of currently supported scope permissions, please check the scope list ",(0,r.kt)("a",{parentName:"td",href:"https://developers.dotwallet.com/documents/en/#user-authorization"},"here")))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Redirect the user to the URI constructed in step 1"),(0,r.kt)("p",{parentName:"li"},"After clicking the link, the user will be directed to the DotWallet authorization page. DotWallet will ask the user to log in, and then ask whether they agree to authorize the application for the listed permission scopes.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Receive the ",(0,r.kt)("inlineCode",{parentName:"p"},"code")," through the callback uri."),(0,r.kt)("p",{parentName:"li"},"After the user agrees to authorization in step 2, DotWallet will redirect the client to the ",(0,r.kt)("inlineCode",{parentName:"p"},"redirect_uri")," specified by the application. The authorization code ",(0,r.kt)("inlineCode",{parentName:"p"},"code")," and the provided ",(0,r.kt)("inlineCode",{parentName:"p"},"state")," will be included in the query parameters.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Exchange ",(0,r.kt)("inlineCode",{parentName:"p"},"code")," for access_token. The access tokens are credentials used to access protected resources, which are issued by the authorization server."))),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"To avoid security issues, any request for using or obtaining ",(0,r.kt)("inlineCode",{parentName:"p"},"access_token")," must be made from the backend server. Do not disclose your ",(0,r.kt)("inlineCode",{parentName:"p"},"access_token")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret"),(0,r.kt)("sup",null,"1")," on the client side.")),(0,r.kt)("h3",{id:"dotwallet-developer-platform"},"DotWallet Developer Platform"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Before using DotWallet, you need to register and create an app on ",(0,r.kt)("a",{parentName:"li",href:"https://developers.dotwallet.com/en"},"DotWallet Developer Platform"),".")),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(5970).Z,width:"1995",height:"670"})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"After creating the app, you will receive an email containing ",(0,r.kt)("inlineCode",{parentName:"li"},"app_id")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"secret"),".")),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(3264).Z,width:"907",height:"493"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Next, you need to set ",(0,r.kt)("a",{parentName:"li",href:"https://www.oauth.com/oauth2-servers/redirect-uris"},"redirection URI"),". Redirect URLs are a critical part of the OAuth flow. After a user successfully authorizes an application, the authorization server will redirect the user back to the application. For example, in the figure below ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/callback/")," is the redirection.")),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(8868).Z,width:"2676",height:"1359"})),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("em",{parentName:"p"},"Callback domain")," in the form is the redirection URIs in OAuth. ")),(0,r.kt)("h2",{id:"example-implementation"},"Example Implementation"),(0,r.kt)("p",null,"Here is an example to integration DotWallet in ",(0,r.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Nextjs"),", a popular React development framework."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Construct URI. ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'export default async function Home() {\n    const client_id = process.env.CLIENT_ID;\n    const redirect_uri = encodeURIComponent(process.env.REDIRECT_URI || \'\');\n    const scope = encodeURIComponent("user.info autopay.bsv");\n    const state = crypto.randomUUID();\n    const loginUrl = `https://api.ddpurse.com/authorize?client_id=${client_id}&redirect_uri=${redirect_uri}&response_type=code&scope=${scope}&state=${state}`;\n    \n    return (\n      <main className="flex min-h-screen flex-col items-center justify-between p-24">\n        <div className="m-4 p-4 bg-blue-200 font-bold rounded-lg">\n          <a href={loginUrl}>DotWallet Login</a>\n        </div>\n      </main>\n    );\n}\n')),(0,r.kt)("center",null,"src/app/page.tsx"),(0,r.kt)("p",null,"If the user clicks the ",(0,r.kt)("strong",{parentName:"p"},"DotWallet Login")," link, the page will be redirected to the wallet authorization page."),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(8837).Z,width:"1920",height:"1091"})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"After the user clicks ",(0,r.kt)("strong",{parentName:"li"},"Agree to authorize")," to log in, the authorization server redirects the user to the redirection URI. The following code receives the ",(0,r.kt)("inlineCode",{parentName:"li"},"code")," through the callback uri,  exchanges the ",(0,r.kt)("inlineCode",{parentName:"li"},"code")," for ",(0,r.kt)("inlineCode",{parentName:"li"},"access_token")," and save it.")),(0,r.kt)("p",null,"Inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," directory, folders are used to ",(0,r.kt)("a",{parentName:"p",href:"https://nextjs.org/docs/app/building-your-application/routing/defining-routes#creating-routes"},"define routes")," in nextjs. we create ",(0,r.kt)("inlineCode",{parentName:"p"},"src/app/callback/route.ts")," to handle the redirection request."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { redirect, notFound } from 'next/navigation';\n\nimport token from \"../token\"\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const code = searchParams.get('code');\n\n  if (code) {\n    // exchange the code for access_token\n    const res = await fetch(`https://api.ddpurse.com/v1/oauth2/get_access_token`, {\n      body: JSON.stringify({\n        code,\n        redirect_uri: process.env.REDIRECT_URI,\n        grant_type: \"authorization_code\",\n        client_secret: process.env.CLIENT_SECRET,\n        client_id: process.env.CLIENT_ID,\n      }),\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      method: 'POST'\n    });\n    const { code: apiCode, data, msg } = await res.json();\n\n    if (apiCode === 0) {\n      const { access_token } = data;\n      // save access_token\n      token.access_token = access_token;\n      // redirect to balance page.\n      redirect('/balance');\n    }\n\n  }\n\n  notFound();\n}\n")),(0,r.kt)("center",null,"src/app/callback/route.ts"),(0,r.kt)("h3",{id:"dotwalletsigner"},(0,r.kt)("inlineCode",{parentName:"h3"},"DotWalletSigner")),(0,r.kt)("p",null,"sCrypt SDK provides ",(0,r.kt)("inlineCode",{parentName:"p"},"DotWalletSigner")," for quick integration with DotWallet."),(0,r.kt)("p",null,"After redirect to the ",(0,r.kt)("inlineCode",{parentName:"p"},"/balance")," page, we can create a ",(0,r.kt)("inlineCode",{parentName:"p"},"DotWalletSigner")," with the OAuth access token, which is passed as the first argument."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'import { DotwalletSigner, DefaultProvider } from "scrypt-ts";\nimport token from "../token";\n\nasync function getData() {\n  const provider = new DefaultProvider();\n  const signer = new DotwalletSigner(token.access_token, provider);\n\n  const balance = await signer.getBalance();\n\n  return { balance: balance.confirmed + balance.unconfirmed };\n}\n\nexport default async function Balance() {\n  const data = await getData();\n\n  return (\n    <main className="flex min-h-screen flex-col items-center justify-between p-24">\n      <div className="m-4 p-4 bg-blue-200 font-bold rounded-lg">\n        <label>balance</label> {data.balance}\n      </div>\n    </main>\n  );\n}\n\n')),(0,r.kt)("center",null,"src/app/balance/page.tsx"),(0,r.kt)("p",null,"After creating ",(0,r.kt)("inlineCode",{parentName:"p"},"DotWalletSigner")," with access token, you can call all interfaces of ",(0,r.kt)("inlineCode",{parentName:"p"},"DotWalletSigner")," as in other ",(0,r.kt)("a",{parentName:"p",href:"/how-to-deploy-and-call-a-contract/#signer"},"signers"),".\nFor example, the example uses the signer to check user's balance."),(0,r.kt)("p",null,"Congrats! You have completed the integration of DotWallet. Full code is ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zhfnjust/dotwallet-example"},"here"),"."),(0,r.kt)("hr",null),(0,r.kt)("p",null,"[1]"," ",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret")," is stored in the backend. It's used to exchange authorization code for access token."))}d.isMDXComponent=!0},8837:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/dotwallet-auth-54d9546108be5338d4752fe8c3a6d5ee.png"},5970:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/dotwallet-create-dapp-e42f147593dca06c2f239c2f6d66234b.png"},3264:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/dotwallet-mail-fe9a6e67c2a7fcdaef60d9c39594f2fa.png"},8868:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/dotwallet-uris-bf561a282110e5d028570e236dae3288.png"},3509:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/oauth2-c0ed02684683987f78f01502b6391332.png"}}]);