---
sidebar_position: 6
---

# Use Script inside sCrypt

Script is a low-level language and acts as assembly for the Bitcoin Virtual Machine. Usually, developers do not have to deal with it directly and can use high-level languages like sCrypt. However, there are cases where using script is desirable. For example, customized script is optimized and thus smaller and more efficient than Script generated by sCrypt. Or script is generated using external tools like [Baguette](https://replit-docs.frenchfrog42.repl.co) and needs to be integrated into sCrypt.

To achieve this currently, you have to edit the auto-generated `.scrypt` files under your project's `artifacts` directory.

First you create a project called `P2PKH`:
```bash
npx scrypt-cli project P2PKH --asm
```
Notice the `--asm` option must be enabled, meaning you are going to use inline assembly format of script.

Your contract is at `src/contracts/p2pkh.ts`:

```ts
export class P2PKH extends SmartContract {
    @prop()
    readonly pubKeyHash: PubKeyHash

    constructor(pubKeyHash: PubKeyHash) {
        super(...arguments)
        this.pubKeyHash = pubKeyHash
    }

    @method()
    public unlock(sig: Sig, pubkey: PubKey) {
        assert(
            hash160(pubkey) == this.pubKeyHash,
            'public key hashes are not equal'
        )
        assert(this.checkSig(sig, pubkey), 'signature check failed')
    }
}
```

Say you want to substitute the `unlock` function with manual script, you edit the file `.asm/asm.json`.

```json
{
  "P2PKH": {
    "unlock": "op_dup op_hash160 $pubKeyHash op_equalverify op_checksig"
  }
}
```

Variables can be defined by prefix `$`, as in `$pubKeyHash`.

We could also define multiple substitutions for multiple methods, if needed.

Now, after every project build, the function body will be replaced with script, as could be seen in `artifacts/P2PKH.scrypt`.

![](../../static/img/asm.png)


This is due to the new `apply-asm` command in`package.json`:
```json
"scripts": {
    "build": "tsc && npm run apply-asm",
    "apply-asm": "node .asm/apply_asm.js",
    ...
```

Lastly, because we used a variable in the ASM code (`$pubKeyHash`), we must set its value after each contract instantiation. We do this using the `replaceAsmVars` function:

```ts
// Set ASM var values.
// Keep in mind, that these are NOT constructor parameters and must be set separately.
p2pkhInstance.replaceAsmVars({
    // Key must be formatted "ContractName.methodName.varName".
    'P2PKH.unlock.pubKeyHash': toHex(myPublicKeyHash)
})
```


For more information, please refer to [here](https://scryptdoc.readthedocs.io/en/latest/asm.html).

:::note
Inline script bypasses many features of sCrypt such as type checking. Extreme caution has to be taken when using this advanced feature.
:::